# tf_base
# Terraform Base Homework

## Убираем дублирование из проекта
В этом задании уберем дублирование ресурсов из проекта. Благодаря мета-аргументу count можно создавать любое количество одинаковых объектов из одного ресурса. Поэтому не имеет смысла описывать несколько ресурсов compute_instance.
Давайте обновим проект, с которым мы работаем в курсе.

1. Оставьте в проекте только один ресурс yandex_compute_instance.
2. Добавьте к нему мета-аргумент count со значением 3.
3. Поменяйте именование виртуальных машин в облаке, чтобы к их именам при создании дописывался index.
4. Добавьте переменную az типа list со списком зон доступности в Yandex Cloud
```ru-central1-a, ru-central1-b, ru-central1-c```
5. Измените конфигурацию виртуальных машин, чтобы брать имя зоны доступности для виртуальной машины из переменной az.
Каждая виртуальная машина должна находиться в своей зоне доступности
6. Так же как и для виртуальных машин оставьте только один ресурс - subnet,  в нем укажите мета-аргумент count со значением 3.
7. Реализуйте создание подсети в каждой зоне доступности (как было показано в уроке), принимая список IPv4 CIDR из переменной cidr_blocks, содержащей список списков подсетей для каждого из сабнетов.
8. Измените ресурс yandex_lb_target_group, чтобы туда попадали виртуальные машины по индексу.
9. Примените конфигурацию, проверьте что все ресурсы именуются правильно.
10. После завершения задания не забудьте удалить инфраструктуру.

## Включение/выключение создания ресурса
В уроке упоминалось, что с помощью мета-аргумента count можно реализовать включение/выключение создания ресурса в конфигурации Terraform. Используйте эту возможность для улучшения работы с SSH ключами, которую мы писали в прошлом уроке.
В конфигурации у нас создается ресурс ```tls_private_key```, вне зависимости от того указал ли пользователь путь к своему ключу.

Отключим его создание, когда он не нужен.

1. Добавьте к описанию ресурса ```tls_private_key``` аргумент count.
2. Укажите условие, что ```count = 0```, если значение переменной ```public_ssh_key_path``` не равно 0, в противном случае ```count = 1```.
3. Протестируйте плейбук с помощью terraform plan в двух сценариях – когда пользователь указывает переменную ```public_ssh_key_path``` и когда нет.
4. Если все сделано верно, при указании переменной в выводе terraform plan должен отсутствовать ресурс ```tls_private_key```