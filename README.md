# tf_base
# Terraform Base Homework

## Усложняем конфигурацию
В двух предыдущих заданиях вы собрали плейбук  Terraform для создания сети, подсетей по одной в зоне доступности, и виртуальных машин в этих подсетях. Пришло время попробовать новый тип ресурсов - сетевые балансировщики. Они нужны для обеспечения доступа к виртуальным машинам и, как следует из названия, балансировки запросов к виртуальной машине.

1. Добавьте в ваш проект отдельный файл loadbalancer.tf
2. Опишите в нем ресурсы yandex_lb_target_group и yandex_lb_network_load_balancer (см документацию провайдера Yandex Cloud)
3. Подключите описанные виртуальные машины в качестве таргетов для балансировщика
Используйте атрибуты для подсетей и виртуальных машин. Для вм возьмите внутренний IP адрес:
```
network_interface.0.ip_address
```
4. Добавьте для новых ресурсов префикс из locals и лейблы из переменных
5. Создайте переменную для указания порта балансировщика (в конфигурации listener {port = ...})
6. Создайте переменную типа object для конфигурации хэлсчеков. Например в таком формате
```
nlb_healthcheck = {
    name   = "test"
    port   = 80
    path   = "/"
}
```
7. Добавьте вывод внешнего адреса балансировщика с помощью outputs
8. Примените конфигурацию, проверьте объекты в UI или с помощью yc
9. После завершения задания удалите созданную инфраструктуру

## Проверка результата:
Так как на виртуальных машинах сейчас у никто не слушает порты и некому отвечать за балансировщиком, виртуальные машины в таргет группах всегда будут неактивны. Для проверки результатов работы вы можете установить на свои виртуальные машины Nginx и запустить его с дефолтной конфигурацией. В дальнейших уроках мы научимся интегрировать Ansible с Terraform для подобных задач.